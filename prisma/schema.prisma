generator client {
  provider   = "prisma-client-js"
  output     = "../generated/prisma"
  engineType = "binary"
}

datasource db {
  provider = "mysql"
}

enum Sex {
  MALE
  FEMALE
  OTHER
}

model BarangaySecretary {
  id           String        @id @default(uuid())
  first_name   String        @db.VarChar(100)
  middle_name  String?       @db.VarChar(100)
  last_name    String        @db.VarChar(100)
  username     String        @unique @db.VarChar(50)
  password     String        @db.LongText
  email        String        @unique @db.VarChar(100)
  appointments Appointment[]
  activityLogs ActivityLog[]

  @@map("barangay_secretaries")
}

model Resident {
  id             String        @id @default(uuid())
  first_name     String        @db.VarChar(100)
  middle_name    String?       @db.VarChar(100)
  last_name      String        @db.VarChar(100)
  address        String        @db.LongText
  birth_date     DateTime
  contact_number String        @db.VarChar(15)
  sex            Sex
  appointments   Appointment[]

  @@map("residents")
}

model Service {
  id           String        @id @default(uuid())
  name         String        @db.VarChar(100)
  description  String?       @db.LongText
  appointments Appointment[]

  @@map("services")
}

model ActivityLog {
  id                    String              @id @default(uuid())
  title                 String              @db.VarChar(255)
  description           String?             @db.LongText
  barangay_secretary_id String?
  created_at            DateTime            @default(now())

  barangay_secretary    BarangaySecretary?  @relation(fields: [barangay_secretary_id], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("activity_logs")
  @@index([barangay_secretary_id], map: "activity_logs_barangay_secretary_id_fkey")
}

model Appointment {
  id                   String   @id @default(uuid())
  resident_id          String?
  service_id           String?
  appointment_datetime DateTime
  created_at           DateTime @default(now())
  processed_by         String?

  processed BarangaySecretary? @relation(fields: [processed_by], references: [id], onDelete: SetNull)
  resident  Resident?          @relation(fields: [resident_id], references: [id], onDelete: Cascade)
  service   Service?           @relation(fields: [service_id], references: [id], onDelete: Cascade)

  @@index([processed_by], map: "appointments_processed_by_fkey")
  @@index([resident_id], map: "appointments_resident_id_fkey")
  @@index([service_id], map: "appointments_service_id_fkey")
  @@map("appointments")
}
